<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat Notification Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin: 20px 0;
        }
        button {
            padding: 10px 20px;
            background-color: #1877f2;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background-color: #166fe5;
        }
        .result {
            padding: 15px;
            border: 1px solid #ccc;
            border-radius: 4px;
            background-color: #f8f9fa;
            min-height: 100px;
        }
        .log-container {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #ccc;
            padding: 10px;
            background-color: #f0f0f0;
            margin-top: 20px;
        }
        .log-entry {
            margin-bottom: 5px;
            font-family: monospace;
        }
        .success {
            color: green;
        }
        .error {
            color: red;
        }
    </style>
</head>
<body>
    <h1>Chat Notification Test</h1>
    <p>This page allows you to test if the chat notification system is working properly.</p>
    
    <div class="test-container">
        <h2>Test Direct Notification</h2>
        <button id="testNotification">Test Notification</button>
        <div id="notificationResult" class="result">Results will appear here...</div>
    </div>
    
    <div class="test-container">
        <h2>Test Event-Based Notification</h2>
        <button id="testNotificationEvent">Test via Custom Event</button>
        <div id="eventResult" class="result">Results will appear here...</div>
    </div>

    <div class="test-container">
        <h2>Check Global Functions</h2>
        <button id="checkFunctions">Check Global Functions</button>
        <div id="functionCheckResult" class="result">Click to check for required global functions...</div>
    </div>

    <h2>Debug Log</h2>
    <div id="logContainer" class="log-container"></div>

    <script>
        // Log function
        function log(message, type = 'info') {
            const logContainer = document.getElementById('logContainer');
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry ${type}`;
            logEntry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
            console.log(message);
        }

        // Test direct notification
        document.getElementById('testNotification').addEventListener('click', function() {
            const result = document.getElementById('notificationResult');
            try {
                if (typeof window.addChatNotification === 'function') {
                    log('Found window.addChatNotification function', 'success');
                    window.addChatNotification(
                        'Test User',
                        'This is a test notification from the standalone test page.',
                        undefined
                    );
                    result.innerHTML = '<span class="success">✓ Notification sent successfully!</span><br>Check if a popup appeared.';
                    log('Notification function called successfully', 'success');
                } else {
                    result.innerHTML = '<span class="error">✗ window.addChatNotification function not found!</span><br>Make sure ChatNotificationManager is loaded.';
                    log('window.addChatNotification function not found', 'error');
                }
            } catch (error) {
                result.innerHTML = `<span class="error">✗ Error: ${error.message}</span>`;
                log(`Error testing notification: ${error.message}`, 'error');
            }
        });

        // Test event-based notification
        document.getElementById('testNotificationEvent').addEventListener('click', function() {
            const result = document.getElementById('eventResult');
            try {
                log('Creating custom event for notification test');
                const event = new CustomEvent('addChatNotification', {
                    detail: {
                        sender: 'Event Test',
                        message: 'This notification was triggered via a custom event.',
                        timestamp: new Date(),
                    }
                });
                document.dispatchEvent(event);
                result.innerHTML = '<span class="success">✓ Event dispatched successfully!</span><br>Check if a popup appeared.';
                log('Custom event dispatched', 'success');
            } catch (error) {
                result.innerHTML = `<span class="error">✗ Error: ${error.message}</span>`;
                log(`Error dispatching event: ${error.message}`, 'error');
            }
        });

        // Check global functions
        document.getElementById('checkFunctions').addEventListener('click', function() {
            const result = document.getElementById('functionCheckResult');
            let html = '<ul>';
            
            // Check for addChatNotification
            if (typeof window.addChatNotification === 'function') {
                html += '<li class="success">✓ window.addChatNotification is available</li>';
                log('window.addChatNotification function found', 'success');
            } else {
                html += '<li class="error">✗ window.addChatNotification is NOT available</li>';
                log('window.addChatNotification function not found', 'error');
            }
            
            // Check for testChatNotification
            if (typeof window.testChatNotification === 'function') {
                html += '<li class="success">✓ window.testChatNotification is available</li>';
                log('window.testChatNotification function found', 'success');
            } else {
                html += '<li class="error">✗ window.testChatNotification is NOT available</li>';
                log('window.testChatNotification function not found', 'error');
            }
            
            // Check for openGlobalChat
            if (typeof window.openGlobalChat === 'function') {
                html += '<li class="success">✓ window.openGlobalChat is available</li>';
                log('window.openGlobalChat function found', 'success');
            } else {
                html += '<li class="error">✗ window.openGlobalChat is NOT available</li>';
                log('window.openGlobalChat function not found', 'error');
            }
            
            // Check for notification container
            const container = document.getElementById('chat-notifications-container');
            if (container) {
                html += '<li class="success">✓ chat-notifications-container exists in DOM</li>';
                log('chat-notifications-container found in DOM', 'success');
            } else {
                html += '<li class="error">✗ chat-notifications-container NOT found in DOM</li>';
                log('chat-notifications-container not found in DOM', 'error');
            }
            
            html += '</ul>';
            result.innerHTML = html;
        });

        // Initial log
        log('Notification test page loaded', 'success');
    </script>
</body>
</html> 